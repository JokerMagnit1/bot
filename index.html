<!DOCTYPE html>
<html>
<head>
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .message { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; }
    .reply-box { margin-top: 5px; }
  </style>
</head>
<body>
  <h2>üí¨ –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
  <div id="messages"></div>

  <script>
    async function loadMessages() {
      const res = await fetch("/messages");
      const data = await res.json();

      const container = document.getElementById("messages");
      container.innerHTML = "";

      data.forEach(msg => {
        const div = document.createElement("div");
        div.className = "message";
        div.innerHTML = `<strong>${msg.user}</strong>: ${msg.text}
          <div class="reply-box">
            <input type="text" placeholder="–û—Ç–≤–µ—Ç–∏—Ç—å..." />
            <button onclick="sendReply('${msg.chat_id}', this.previousElementSibling.value)">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>`;
        container.appendChild(div);
      });
    }

    async function sendReply(chat_id, text) {
      await fetch("/reply", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id, text })
      });
      alert("‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω");
    }

    loadMessages();
    setInterval(loadMessages, 5000);  // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  </script>
</body>
</html>